<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="x-ua-compatible" content="ie=edge">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="">
<meta name="author" content="">
<!-- Favicons Icon -->
<title>aaaaa</title>
<!-- Mobile Specific -->
<meta name="viewport"
	content="width=device-width, initial-scale=1, maximum-scale=1">
<!-- CSS Style -->
<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="css/font-awesome.css">
<link rel="stylesheet" type="text/css" href="css/owl.carousel.css">
<link rel="stylesheet" type="text/css" href="css/jquery.mobile-menu.css">
<link rel="stylesheet" type="text/css" href="css/revslider.css">
<link rel="stylesheet" type="text/css" href="css/style.css">
<link rel="stylesheet" type="text/css" href="css/mdialog.css">
<!-- Google Fonts -->
<link href="css/ac2ae5775c664fb682a6b10e460efad2.css" rel="stylesheet">
</head>
<body class="category-page">
	<div id="page">
		<!-- Header -->
		<header>
			<div class="header-container"></div>
		</header>
		<!-- Breadcrumbs -->
		<div class="breadcrumbs">
			<div class="container">
				<div class="row">
					<div class="col-xs-12">
						<ul>
							<li class="home"><a href="index.html">主页</a><span>/</span></li>
							<li><a href="grid.html">水果</a><span>/</span></li>
							<li><strong>自定义果篮</strong></li>
						</ul>
					</div>
				</div>
			</div>
		</div>
		<!-- Breadcrumbs End -->
		<!-- Main Container -->
		<section class="main-container col2-left-layout">
			<div class="container">
				<div class="row">
					<div class="col-sm-9 col-xs-12 col-sm-push-3">
						<!-- category slider -->
						<div class="category-description std">
							<div class="slider-items-products">
								<div id="category-desc-slider"
									class="product-flexslider hidden-buttons">
									<div
										class="slider-items slider-width-col1 owl-carousel owl-theme">
										<div class="item">
											<a href="#"><img alt="Fresh Vegetables"
												src="picture/category-img1.jpg"></a>
											<div class="cat-img-title cat-bg cat-box">
												<div class="small-tag">活的新鲜</div>
												<h2 class="cat-heading">新鲜蔬菜</h2>
												<p>Lorem ipsum dolor sit amet, consectetur adipiscing
													elit.</p>
											</div>
										</div>
										<div class="item">
											<a href="#"><img alt="Healthy Eating"
												src="picture/category-img2.jpg"></a>
											<div class="cat-img-title cat-bg cat-box">
												<div class="small-tag">季节减价</div>
												<h2 class="cat-heading">饮食与养生</h2>
												<p>Lorem ipsum dolor sit amet, consectetur adipiscing
													elit.</p>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
						<!-- End category slider -->
						<!-- Col- Main -->
						<article class="col-main">
							<h2 class="page-heading">
								<span class="page-heading-title">自定义果篮</span>
							</h2>
							<div class="display-product-option">
								<div class="pager hidden-xs">
									<div class="pages">
										<ul class="pagination">
											<li><a href="#">&laquo;</a></li>
											<li class="active"><a href="#">1</a></li>
											<li><a href="#">2</a></li>
											<li><a href="#">3</a></li>
											<li><a href="#">4</a></li>
											<li><a href="#">5</a></li>
											<li><a href="#">&raquo;</a></li>
										</ul>
									</div>
								</div>
								<div class="sorter">
									<div class="view-mode">
										<span title="Grid" class="button button-active button-grid"><i
											class="fa fa-th" aria-hidden="true"></i></span><a href="list.html"
											title="List" class="button-list"><i class="fa fa-list-ul"
											aria-hidden="true"></i></a>
									</div>
								</div>
							</div>
							<div class="category-products">
								<ul class="products-grid" style="display:block">

								</ul>
								<ol class="products-list" id="products-list"
									style="display:none">

								</ol>
							</div>
							<div class="toolbar">
								<div class="row">
									<div class="col-lg-3 col-md-4">
										<div id="sort-by">
											<label class="left">排序方式:</label>
											<ul>
												<li><a href="#">Position<span class="right-arrow"></span></a>
													<ul>
														<li><a href="#">名称</a></li>
														<li><a href="#">价钱</a></li>
														<li><a href="#">位置</a></li>
													</ul></li>
											</ul>
										</div>
									</div>
									<div class="col-lg-6 col-sm-7 col-md-5">
										<div class="pager">
											<div class="pages">
												<label>页:</label>
												<ul class="pagination">
													<li><a href="#">&laquo;</a></li>
													<li class="active"><a href="#">1</a></li>
													<li><a href="#">2</a></li>
													<li><a href="#">3</a></li>
													<li><a href="#">4</a></li>
													<li><a href="#">5</a></li>
													<li><a href="#">&raquo;</a></li>
												</ul>
											</div>
										</div>
									</div>
									<div class="col-lg-3 col-sm-12 col-md-3">
										<div id="limiter">
											<label>查看:</label>
											<ul>
												<li><a href="#">09<span class="right-arrow"></span></a>
													<ul>
														<li><a href="#">15</a></li>
														<li><a href="#">20</a></li>
														<li><a href="#">30</a></li>
														<li><a href="#">35</a></li>
													</ul></li>
											</ul>
											<a class="button-asc left" href="#"
												title="Set Descending Direction"><span class="top_arrow"></span></a>
										</div>
									</div>
								</div>
							</div>
						</article>
						<!--	End col Main  -->
					</div>
					<!-- Sidebar  -->
					<div class="col-left sidebar col-sm-3 col-xs-12 col-sm-pull-9">
						<aside class="col-left sidebar">

							<div class="block block-cart"
								style="height:400px;width:315px;overflow:auto">
								<div class="block-title ">我的果篮</div>
								<div class="block-content">
									<div class="summary">
										<p class="amount">
											您的果篮中有<a href="">0</a>件商品.
										</p>
										<p class="subtotal">
											<span class="label">小计:</span><span class="price">0</span>
										</p>
									</div>
									<div class="ajax-checkout">
										<button class="button button-checkout" title="Submit"
											type="submit">
											<input type="hidden" value="" /> <span>加入购物车 </span>
										</button>
									</div>
									<p class="block-subtitle">最近添加的项目</p>
									<ul id="abc">
									</ul>
								</div>
							</div>
						</aside>
					</div>
				</div>
		</section>
		<div class="brand-logo">
			<div class="container">
				<div class="slider-items-products">
					<div id="brand-logo-slider"
						class="product-flexslider hidden-buttons">
						<div class="slider-items slider-width-col6">
							<div class="item">
								<a href="#"><img src="picture/b-logo3.png"
									style="width: 205px;height: 100px;" alt="Brand Logo"></a>
							</div>
							<div class="item">
								<a href="#"><img src="picture/b-logo1.png"
									style="width: 205px;height: 100px;" alt="Brand Logo1"></a>
							</div>
							<div class="item">
								<a href="#"><img src="picture/b-logo2.png"
									style="width: 205px;height: 100px;" alt="Brand Logo2"></a>
							</div>
							<div class="item">
								<a href="#"><img src="picture/b-logo4.png"
									style="width: 205px;height: 100px;" alt="Brand Logo3"></a>
							</div>
							<div class="item">
								<a href="#"><img src="picture/b-logo5.png"
									style="width: 205px;height: 100px;" alt="Brand Logo4"></a>
							</div>
							<div class="item">
								<a href="#"><img src="picture/b-logo6.png"
									style="width: 205px;height: 100px;" alt="Brand Logo5"></a>
							</div>
							<div class="item">
								<a href="#"><img src="picture/b-logo2.png"
									style="width: 205px;height: 100px;" alt="Brand Logo6"></a>
							</div>
							<div class="item">
								<a href="#"><img src="picture/b-logo4.png"
									style="width: 205px;height: 100px;" alt="Brand Logo7"></a>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- End Brand Logo Section -->
		<!-- Footer -->
		<footer>
			<div class="footer-page"></div>
		</footer>
		<!-- End Footer -->
	</div>
	<!-- End page -->
	<!-- mobile menu -->
	<!-- JavaScript -->
	<script src="js/jquery.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script src="js/owl.carousel.min.js"></script>
	<script src="js/jquery.mobile-menu.min.js"></script>
	<script type="text/javascript" src="js/zepto.min.js"></script>
	<script type="text/javascript" src="js/mdialog.js"></script>
	<script src="js/common.js"></script>
	<script type="text/javascript">
		/* function goDesc(url) {
			//跳转之前将局部页面保存到sessionStorage对象中。
			window.sessionStorage.setItem("basket", $(".products-grid").html());
			window.location.href = url;
		}
		
		} */
		function aaa() {
			//读取sessionStorage对象中的内容
			var myhtml = window.sessionStorage.getItem("basket");
			//不为空表示是返回上一步进入该页面的。
			var baa = window.sessionStorage.getItem("ba");
			if (baa != null) {
				//将sessionStorage对象中保存的页面添加到页面中
				$("#abc").html(baa);
			}
			if (myhtml != null) {
				//将sessionStorage对象中保存的页面添加到页面中
				$(".products-grid").html(myhtml);
			//清空sessionStorage对象的内容。
			/* window.sessionStorage.clear(); */
			}
		}
		$(document).ready(function() {
	
			$(".header-container").load("header.html");
			$(".footer-page").load("footer.html");
			aaa();
			//加入购物车
			$(".button-checkout").click(function() {
				if (parseInt($(".amount>a").text()) < 5) {
					new TipBox({
						type : 'tip',
						str : '至少要选5种水果',
						clickDomCancel : true,
						setTime : 10000500,
						hasBtn : true
					});
					return;
				}
				if (parseInt($(".amount>a").text()) > 8) {
					new TipBox({
						type : 'tip',
						str : '最多只能选8种水果',
						clickDomCancel : true,
						setTime : 10000500,
						hasBtn : true
					});
					return;
				}
				var nam = "";
				$("li[name='prog']").each(function() {
					var n = $(this).find(".product-name").text();
					var numm = $(this).find(".asd").text();
					nam += n + "*" + numm + " ";
				})
				var pric = $(".subtotal").find(".price").text();
				$.post("addBasketServlet", "name=" + nam + "&price=" + pric, addCartOut, "text");
				function addCartOut(data) {
					$.post("ShoppingCarServlet", {
						"id" : data,
						"num" : 1
					}, function(data) {
						new TipBox({
							type : 'success',
							str : '加入购物车成功',
							hasBtn : true
						});
						//清空购物车列表
						$("#cart-sidebar").empty();
						//动态构建购物车列表
						//将加入到购物车的商品显示出来	 
						var str = "";
						var money = 0;
						for (var i = 0; i < data.length; i++) {
							str += "<li class='item'><div class='item-inner'><a class='product-image' title='" + data[i].name + "' href='shopping_cart.html?id=" + data[i].id + "'><img alt='Retis lapen casen'  src='products-images/" + data[i].imgUrl + "'></a><div class='product-details'><div class='access'><a class='btn-remove1' title='Remove This Item' href='#'>删除</a><a class='btn-edit' title='Edit item' href='#'><i class='fa fa-pencil'></i><span class='hidden'>编辑</span></a></div><strong>" + data[i].num + "</strong>x <span class='price'>" + data[i].promotePrice + "</span><p class='product-name'><a href='shopping_cart.html" + data[i].id + "'>" + data[i].name + "</a></p></div></div></li>";
							money += data[i].num * data[i].promotePrice;
						}
						$("#cart-sidebar").html(str);
						var len = $("#cart-sidebar").children().length;
						$(".cart_count").text(len); //购物车商品个数
						$(".cart-title").next().text("￥" + money.toFixed(2)); //总价格
						window.sessionStorage.setItem("pull-right", $(".pull-right").html());
					}, "JSON")
				}
			})
	
			$.post("GetFruitServlet", getFruit, "html");
			function getFruit(data) {
				$(".products-grid").html(data);
				window.sessionStorage.setItem("basket", data);
			}
			$('body').on('click', '.btn-cart', function() {
				var s = $(this).find("span").attr("id");
				$.post("GetProServlet", "id=" + s, getPro, "json");
			})
	
			function getPro(data) {
				var nu = 1;
				$("li[name='prog']").each(function() {
					if (parseInt($(this).attr("pro")) == data.id) {
						nu++;
					}
				})
				if (nu == 1) {
					$("#abc").append("<li name='prog' class='item' pro='" + data.id + "'><div class='item-inner'><a class='product-image' title='Retis lapen casen' href='shopping_cart.html?id=" + data.id + "&imgUrl=" + data.imgUrl + "'><img alt='Retis lapen casen' src='picture/" + data.imgUrl + "'></a><div class='product-details'><div class='access'><a class='btn-remove1' title='Remove This Item' href='#'>删除</a></div><strong class='asd'>1</strong>x <span class='price' name = 'pr'>" + data.promotePrice + "</span><p class='product-name'><a href=''  name='pro'>" + data.name + "</a></p></div></div></li>");
				} else {
					$("li[pro='" + data.id + "']").children(".item-inner").children(".product-details").children("strong").text(nu);
				}
				total();
				new TipBox({
					type : 'success',
					str : '添加成功',
					hasBtn : true
				});
				window.sessionStorage.setItem("ba", $("#abc").html());
			}
			function total() {
				var pri = 0;
				var num = 0;
				$("span[name='pr']").each(function() {
					var pr = $(this).text();
					var n = $(this).prev().text();
					pri = Number(pr) * Number(n) + pri;
					num = num + Number(n);
				})
				$(".subtotal").find(".price").text(pri);
				$(".amount>a").text(num);
			}
			$('body').on('click', '.access', function() {
				$(this).parent().parent().parent().remove();
				total();
				new TipBox({
					type : 'success',
					str : '删除成功',
					hasBtn : true
				});
			})
			$(window).on("scroll", function() {
				var top = $(this).scrollTop();
				if (top == 0) {
					$(".col-sm-3").css({
						"position" : "",
						"left" : "",
						"top" : ""
					});
				}
				if (top > 50 && top < $(".brand-logo").offset().top - 800) {
					$(".col-sm-3").css({
						"width" : "315px",
						"height" : "469px",
						"position" : "fixed",
						"left" : "130px",
						"top" : "210px"
					});
				}
				if (top > $(".brand-logo").offset().top - 800) {
					$(".col-sm-3").css({
						"width" : "315px",
						"height" : "469px",
						"position" : "",
						"left" : "",
						"top" : $(".brand-logo").offset().top - 800
					});
				}
			})
		})
	</script>
</body>
</html>